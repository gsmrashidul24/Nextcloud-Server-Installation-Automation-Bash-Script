
# 								┬о┬о┬о┬о┬о┬о┬о┬о┬о┬о┬о┬о┬о┬о┬о┬о┬о┬о┬о┬о┬о┬о┬о┬о┬о┬о┬о┬о┬о┬о┬о┬о┬о┬о┬о┬о┬о┬о┬о#
#   						┬о┬о┬о┬о┬о┬о┬о┬о┬о┬о┬о[DOCUMENTATION REPORT]┬о┬о┬о┬о┬о┬о┬о┬о┬о┬о┬о   
#									┬о┬о┬о┬о┬о┬о┬о┬о┬о┬о┬о┬о┬о┬о┬о┬о┬о┬о┬о┬о┬о┬о┬о┬о┬о┬о┬о┬о┬о┬о┬о┬о┬о┬о┬о┬о┬о┬о┬о┬о
																																		 										 
#	  	 			Nextcloud + Cloudflared AUTO INSTALLER DOCUMENTATION	  	 
#						****************************************************
																					 																				 			
# 														Created by Rasel-Tech	 															  
# 									Compatible with: Ubuntu 22.04 / 24.04	 									    
#										*************************************  																	 								 					 																						



ЁЯУШ Nextcloud + Cloudflared Auto Installer Script ржмрж┐рж╢рзНрж▓рзЗрж╖ржг рж░рж┐ржкрзЛрж░рзНржЯ

ржлрж╛ржЗрж▓: nextcloud_setup.sh
рждрзИрж░рж┐ ржХрж░рзЗржЫрзЗржи: Rasel-Tech
рж╕рж┐рж╕рзНржЯрзЗржо рж╕рж╛ржкрзЛрж░рзНржЯ: Ubuntu 22.04 / 24.04


ЁЯза ржорзВрж▓ ржЙржжрзНржжрзЗрж╢рзНржп

ржПржЗ рж╕рзНржХрзНрж░рж┐ржкрзНржЯржЯрж┐ рж╕рзНржмржпрж╝ржВржХрзНрж░рж┐ржпрж╝ржнрж╛ржмрзЗ Nextcloud рж╕рж╛рж░рзНржнрж╛рж░ ржЗржирж╕рзНржЯрж▓ ржУ ржХржиржлрж┐ржЧрж╛рж░ ржХрж░рзЗ, ржпрж╛рж░ рж╕рж╛ржерзЗ ржпрзБржХрзНржд ржерж╛ржХрзЗтАФ

Apache2 + PHP 8.2-FPM

MariaDB + Redis

Cloudflare Tunnel (рж╕рзНржмржпрж╝ржВржХрзНрж░рж┐ржпрж╝ DNS, SSL ржПржмржВ Origin CA рж╕рж╛рж░рзНржЯрж┐ржлрж┐ржХрзЗржЯрж╕рж╣)

Firewall, Fail2Ban, ржУ ржХрзНрж░ржиржЬржм рж╣рзЗрж▓рже ржЪрзЗржХ

рж╕ржорзНржкрзВрж░рзНржг ржирж┐рж░рж╛ржкрждрзНрждрж╛ ржУ ржЕржЯрзЛ-рж░рж┐ржХржнрж╛рж░рж┐ ржлрж┐ржЪрж╛рж░


тЪЩя╕П ржорзВрж▓ ржмрзИрж╢рж┐рж╖рзНржЯрзНржп (Features & Highlights)

ЁЯФР ржЗржирзНржЯрж╛рж░тАМрзНржпрж╛ржХржЯрж┐ржн ржЗржиржкрзБржЯ (ржбрзЛржорзЗржЗржи, DB, API Token, ржЗржорзЗржЗрж▓, ржЗрждрзНржпрж╛ржжрж┐)

ЁЯМР Cloudflare Tunnel API ржЗржирзНржЯрж┐ржЧрзНрж░рзЗрж╢ржи

ЁЯзй Apache + PHP 8.2-FPM Auto-tuning

ЁЯТ╛ MariaDB + Redis ржХржиржлрж┐ржЧрж╛рж░рзЗрж╢ржи

тЪб Auto Memory Allocation (RAM ржнрж┐рждрзНрждрж┐ржХ)

ЁЯФТ TLS/SSL рж╕рж╛рж░рзНржЯрж┐ржлрж┐ржХрзЗржЯ ржЕржЯрзЛ ржЗрж╕рзНржпрзБ (Cloudflare Origin CA)

ЁЯЪА System Hardening, Firewall, Fail2Ban ржУ Cron Health Check


ЁЯзй рж╕рзНржХрзНрж░рж┐ржкрзНржЯрзЗрж░ ржкрзНрж░ржзрж╛ржи ржзрж╛ржкрж╕ржорзВрж╣

1я╕ПтГг Root Check & Logging

Root ржирж╛ рж╣рж▓рзЗ рж╕рзНржХрзНрж░рж┐ржкрзНржЯ ржерзЗржорзЗ ржпрж╛ржпрж╝ред

ржкрзНрж░рждрж┐ржЯрж┐ Error рж▓ржЧ рж╣ржпрж╝ /var/log/nextcloud-install.log-ржПред


2я╕ПтГг User Input Section

ржирж┐ржЪрзЗрж░ рждржерзНржпржЧрзБрж▓рзЛ ржЗржЙржЬрж╛рж░рзЗрж░ ржХрж╛ржЫ ржерзЗржХрзЗ ржирзЗржпрж╝рж╛ рж╣ржпрж╝:

Domain Name

Tunnel Name

Nextcloud Admin Username/Password

Database Name, User, Password

Cloudflare API Token ржУ Zone ID

Optional Admin Email


Cloudflare Token Verify ржХрж░рж╛ рж╣ржпрж╝ API ржХрж▓рзЗрж░ ржорж╛ржзрзНржпржорзЗ тЬЕ


3я╕ПтГг System Preparation

apt update && apt full-upgrade -y

ржЗржирж╕рзНржЯрж▓ ржХрж░рж╛ ржкрзНржпрж╛ржХрзЗржЬрж╕ржорзВрж╣:

curl, wget, vim, git, ufw, lsb-release,
apt-transport-https, ca-certificates, gnupg,
openssl, unzip, fail2ban, zip, coreutils

Timezone рж╕рзЗржЯ ржХрж░рзЗ ржУ NTP ржЪрж╛рж▓рзБ ржХрж░рзЗред

RAM < 4GB рж╣рж▓рзЗ рж╕рзНржмржпрж╝ржВржХрзНрж░рж┐ржпрж╝ржнрж╛ржмрзЗ swap ржлрж╛ржЗрж▓ рждрзИрж░рж┐ ржХрж░рзЗред


4я╕ПтГг Data Directory

/mnt/nextcloud_data ржбрж┐рж░рзЗржХрзНржЯрж░рж┐ рждрзИрж░рж┐ ржХрж░рзЗ

ржорж╛рж▓рж┐ржХрж╛ржирж╛: www-data:www-data

ржкрж╛рж░ржорж┐рж╢ржи: 750


5я╕ПтГг Apache2 + PHP 8.2-FPM

mpm_event, proxy_fcgi, php-fpm ржХржиржлрж┐ржЧрж╛рж░

ржкрзНрж░рзЯрзЛржЬржирзАрзЯ PHP ржПржХрзНрж╕ржЯрзЗржирж╢ржи ржЗржирж╕рзНржЯрж▓

RAM ржЕржирзБржпрж╛рзЯрзА PHP memory_limit ржУ OPcache auto-tuning


6я╕ПтГг Redis ржХржиржлрж┐ржЧрж╛рж░рзЗрж╢ржи

Redis Unix socket рж╕ржХрзНрж░рж┐ржпрж╝

www-data ржЧрзНрж░рзБржкрзЗ redis ржпрзЛржЧ ржХрж░рж╛

Redis status check ржХрж░рзЗ тАЬRedis is up and running.тАЭ рж▓ржЧ ржХрж░рзЗ тЬЕ


7я╕ПтГг MariaDB рж╕рзЗржЯржЖржк

mariadb-server ржЗржирж╕рзНржЯрж▓

Root ржУ ржЗржЙржЬрж╛рж░ ржкрж╛рж╕ржУржпрж╝рж╛рж░рзНржб рж╕рзЗржЯ

Nextcloud Database рждрзИрж░рж┐

RAM ржЕржирзБржпрж╛рзЯрзА innodb_buffer_pool_size ржУ log_file_size ржЕржЯрзЛ ржЯрж┐ржЙржи


8я╕ПтГг Nextcloud ржЗржирж╕рзНржЯрж▓рзЗрж╢ржи

Nextcloud zip ржбрж╛ржЙржирж▓рзЛржб ржХрж░рзЗ /var/www/html/nextcloud-ржП ржЗржирж╕рзНржЯрж▓

Apache VirtualHost рждрзИрж░рж┐

Headless ржЗржирж╕рзНржЯрж▓рзЗрж╢ржирзЗрж░ ржЬржирзНржп OCC ржХржорж╛ржирзНржб ржЪрж╛рж▓рж╛ржпрж╝

Trusted Domain, Redis, Overwrite settings ржХржиржлрж┐ржЧрж╛рж░ ржХрж░рзЗ


9я╕ПтГг Cloudflare Tunnel Setup

API ржжрж┐рзЯрзЗ Tunnel рждрзИрж░рж┐ (headless)

ржпржжрж┐ ржмрзНржпрж░рзНрже рж╣ржпрж╝, Manual JSON Import fallback

/etc/cloudflared/config.yml рждрзИрж░рж┐ ржХрж░рзЗ


ЁЯФз Cloudflare DNS Configuration

API ржжрж┐рзЯрзЗ CNAME рж░рзЗржХрж░рзНржб рждрзИрж░рж┐ ржХрж░рзЗ:

<your-domain> тЖТ <tunnel_id>.cfargotunnel.com


ЁЯФР Cloudflare Origin SSL Setup

Cloudflare API ржерзЗржХрзЗ Origin CA рж╕рж╛рж░рзНржЯрж┐ржлрж┐ржХрзЗржЯ ржЗрж╕рзНржпрзБ

рж╕рж╛рж░рзНржЯрж┐ржлрж┐ржХрзЗржЯ ржУ ржХрзА /etc/ssl/nextcloud ржП рж╕ржВрж░ржХрзНрж╖рж┐ржд

Apache HTTPS vhost рж╕рзЗржЯржЖржк тЬЕ


ЁЯФе Firewall & Fail2ban

UFW тЖТ Allow ports 22, 80, 443

Fail2ban тЖТ SSH ржУ Nextcloud рж▓ржЧ ржоржирж┐ржЯрж░

SSH brute-force ржкрзНрж░рждрж┐рж░рзЛржзрзЗ rate-limit рж╕рзЗржЯ


ЁЯза Cron & Health Check

www-data ржЗржЙржЬрж╛рж░рзЗрж░ ржЬржирзНржп ржкрзНрж░рждрж┐ рзл ржорж┐ржирж┐ржЯрзЗ Nextcloud cron.php рж░рж╛ржи

/etc/cron.daily/nextcloud_healthcheck

Apache2, MariaDB, Redis, Cloudflared рж╕рзНржмржпрж╝ржВржХрзНрж░рж┐ржпрж╝ржнрж╛ржмрзЗ ржоржирж┐ржЯрж░ ржУ рж░рж┐рж╕рзНржЯрж╛рж░рзНржЯ ржХрж░рзЗ

ржнржмрж┐рж╖рзНржпрждрзЗ Telegram alert ржЗржирзНржЯрж┐ржЧрзНрж░рзЗрж╢ржи ржХрж░рж╛ ржпрж╛ржмрзЗ (рж╕рзНржХрзНрж░рж┐ржкрзНржЯрзЗ ржоржирзНрждржмрзНржп ржЖржХрж╛рж░рзЗ ржЖржЫрзЗ)ред


ЁЯз╣ Cleanup & Final Steps

рж╕ржорж╕рзНржд рж╕ржВржмрзЗржжржирж╢рзАрж▓ ржнрзНржпрж╛рж░рж┐ржпрж╝рзЗржмрж▓ unset

apt clean

рж╕рж╛рж░рзНржнрж┐рж╕ рж╕рзНржЯрзНржпрж╛ржЯрж╛рж╕ ржЪрзЗржХ

рж╢рзЗрж╖рзЗ рж░рж┐ржмрзБржЯ рж░рж┐ржХржорзЗржирзНржбрзЗрж╢ржи ржжрзЗржЦрж╛ржпрж╝


тЪая╕П рж╕ржорзНржнрж╛ржмрзНржп рж╕ржорж╕рзНржпрж╛ ржмрж╛ ржЭрзБржБржХрж┐

ЁЯза Syntax									тЬЕ ржарж┐ржХ ржЖржЫрзЗ
ЁЯФй Variable Handling	  тЬЕ рж╕ржм ржарж┐ржХржнрж╛ржмрзЗ quoted	
ЁЯз░ MariaDB Logic				тЬЕ ржарж┐ржХржнрж╛ржмрзЗ ржХрж╛ржЬ ржХрж░ржмрзЗ	
тЪЩя╕П Redis Socket					  тЬЕ fallback рж╕рж┐рж╕рзНржЯрзЗржо рж╕ржарж┐ржХ	
ЁЯФТ Cloudflare TLS				тЬЕ TLS verify рж╕ржХрзНрж░рж┐рзЯ (false рж╕рзЗржЯ ржХрж░рж╛ рж╣рзЯрзЗржЫрзЗ)	
ЁЯУЬ Base64 Dependency	тЬЕ coreutils ржЗржирж╕рзНржЯрж▓ рж╣ржУрзЯрж╛рзЯ рж╕ржорж╛ржзрж╛ржи	
ЁЯз╛ Cloudflare API				 тЬЕ рж╕ржарж┐ржХржнрж╛ржмрзЗ verify ржХрж░рзЗ	
ЁЯз▒ Security Cleanup			тЬЕ ржарж┐ржХржнрж╛ржмрзЗ ржХрж╛ржЬ ржХрж░ржЫрзЗ	


ЁЯФТ ржирж┐рж░рж╛ржкрждрзНрждрж╛ ржУ рж╕рзНржерж┐рждрж┐рж╢рзАрж▓рждрж╛

тЬЕ рж╕ржХрзНрж░рж┐ржпрж╝ рж╕рзБрж░ржХрзНрж╖рж╛ ржлрж┐ржЪрж╛рж░:

Fail2Ban brute-force ржкрзНрж░рждрж┐рж░рзЛржз

Firewall Active

SSH rate-limit

TLS тАЬFull (Strict)тАЭ ржорзЛржб рж╕рж╛ржкрзЛрж░рзНржЯ

Systemd restart policies

Sensitive data clear at end


ЁЯУИ рж╕рж╛рж░рж╕ржВржХрзНрж╖рзЗржк ржорзВрж▓рзНржпрж╛ржпрж╝ржи

тЪЩя╕П Logic Flow 				 	тЬЕ рж╢ржХрзНрждрж┐рж╢рж╛рж▓рзА
ЁЯза Syntax								 тЬЕ ржирж┐ржЦрзБржБржд
ЁЯМР Cloudflare Tunnel	тЬЕ рж╕рзНржерж┐рждрж┐рж╢рзАрж▓
ЁЯФР TLS & SSL					 	тЬЕ рж╕рзБрж░ржХрзНрж╖рж┐ржд
ЁЯТ╛ Database							тЬЕ рж╕рзНржерж┐рждрж┐рж╢рзАрж▓
тЪб Performance				  тЬЕ RAM ржЯрж┐ржЙржирж┐ржВрж╕рж╣ ржЪржорзОржХрж╛рж░
ЁЯФе Firewall / Fail2Ban	тЬЕ ржХрж╛рж░рзНржпржХрж░


ЁЯПБ ржЪрзВржбрж╝рж╛ржирзНржд рж░рж╛ржпрж╝

тЬЕ ржПржЯрж┐ ржПржХржЯрж┐ ржирж┐рж░рж╛ржкржж, рж╢ржХрзНрждрж┐рж╢рж╛рж▓рзА, ржПржмржВ рж╕ржорзНржкрзВрж░рзНржг рж╕рзНржмржпрж╝ржВржХрзНрж░рж┐ржпрж╝ Nextcloud ржЗржирж╕рзНржЯрж▓рж╛рж░ рж╕рзНржХрзНрж░рж┐ржкрзНржЯред

> Cloudflare-ржП ржЕржмрж╢рзНржпржЗ SSL/TLS Mode тЖТ Full (Strict) рж╕рзЗржЯ ржХрж░ржмрзЗ, рждрж╛рж╣рж▓рзЗржЗ end-to-end encryption рж╕ржорзНржкрзВрж░рзНржг рж╣ржмрзЗред

